OASISFormat: 0.4
Name: cothrift
Version: 0.1
Synopsis: OCaml runtime for the Apache Thrift RPC system
Authors: Petter A. Urkedal
License: LGPL-3 with OCaml linking exception
AlphaFeatures: pure_interface
Plugins: DevFiles (0.4), META (0.4)
BuildTools: ocamlbuild

Flag lwt
  Description: build lwt support
  Default: true

Library "cothrift"
  Path: lib
  Modules:
    Thrift,
    Thrift_ext_protocol,
    Thrift_sig,
    Thrift_protocol_binary

Library "cothrift-lwt"
  Path: lib
  FindlibParent: cothrift
  FindlibName: lwt
  Modules:
    Thrift_lwt,
    Thrift_lwt_sig
  BuildDepends: cothrift, lwt
  Build$: flag(lwt)
  Install$: flag(lwt)

Library "cothrift-lwt-unix"
  Path: lib
  FindlibParent: cothrift
  FindlibName: lwt-unix
  Modules:
    Thrift_lwt_unix
  BuildDepends: cothrift.lwt, conduit.lwt-unix
  Build$: flag(lwt)
  Install$: flag(lwt)

Library ppx_deriving_thrift
  FindlibParent: cothrift
  FindlibName: ppx
  Path: ppx
  Modules:
    Ppx_deriving_thrift,
    Ppx_thrift_helper,
    Ppx_thrift_preapply,
    Ppx_thrift_read,
    Ppx_thrift_write
  BuildDepends: ppx_deriving.api

Document api
  Title: Cothrift API Reference
  Type: ocamlbuild (0.4)
  InstallDir: $htmldir/html
  BuildTools+: ocamldoc
  XOCamlbuildPath: lib
  XOCamlbuildLibraries: cothrift
  DataFiles: COPYING ($docdir), COPYING.LESSER ($docdir)

Executable testsuite
  Install: false
  Path: tests
  MainIs: testsuite.ml
  BuildDepends: cothrift.lwt-unix, ppx_deriving.api, oUnit
  Build$: flag(lwt)
  Install$: flag(lwt)

Test "testsuite"
  Type: Custom (0.4)
  Command: $testsuite
  Run$: flag(lwt)
